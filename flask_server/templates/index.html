<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ESP Dashboard</title>
  <style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #f2f4f8;
    color: #333;
    max-width: 600px;
    margin: 3rem auto;
    padding: 2rem;
    border-radius: 12px;
    background-color: #ffffff;
    box-shadow: 0 0 20px rgba(0,0,0,0.08);
  }

  h1, h2 {
    text-align: center;
    color: #2a3f54;
  }

  label {
    display: block;
    margin: 1rem 0 0.4rem;
    font-weight: 600;
  }

  input[type=number],
  select {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
  }

  button {
    padding: 0.6rem 1.2rem;
    margin-top: 1.2rem;
    border: none;
    border-radius: 6px;
    background-color: #2a9df4;
    color: white;
    font-weight: bold;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  button:hover {
    background-color: #1c87d9;
  }

  .row {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .row button {
    flex: 1;
  }

  hr {
    margin: 2rem 0;
    border: none;
    border-top: 1px solid #ddd;
  }

  form {
    margin-top: 1rem;
  }
</style>
</head>
<body>

  <h1>ESP8266 Control Panel</h1>

  <!-- API key prompt -->
  <script>
    let apiKey = localStorage.getItem("esp_api_key") || "";
    if (!apiKey) {
      apiKey = prompt("Enter your X-API-Key:");
      localStorage.setItem("esp_api_key", apiKey);
    }
  </script>

  <!-- Form fields -->
  <div>
    <label>Person count:
      <input type="number" id="value" min="0">
    </label>

    <label>Direction:
      <select id="direction">
        <option value="0">0 (increment)</option>
        <option value="1">1 (decrement)</option>
      </select>
    </label>

    <label>Wait for next Sensor1 (ms):
      <input type="number" id="waitForNextSensor1" min="0">
    </label>

    <label>Wait for next Sensor2 (ms):
      <input type="number" id="waitForNextSensor2" min="0">
    </label>

    <label>Wait after reading Sensor1 (ms):
      <input type="number" id="waitAfterReading1" min="0">
    </label>

    <label>Wait after reading Sensor2 (ms):
      <input type="number" id="waitAfterReading2" min="0">
    </label>

    <div class="row">
      <button id="btnFetch">Refresh</button>
      <button id="btnUpdate">Update All</button>
      <button id="btnReset">Reset Count</button>
    </div>
  </div>

  <script>
    const headers = { "Content-Type": "application/json", "X-API-Key": apiKey };
    const fetchData = async () => {
      try {
        const res = await fetch("/count", { headers });
        const j = await res.json();
        document.getElementById("value").value = j.value;
        document.getElementById("direction").value = j.direction;
        document.getElementById("waitForNextSensor1").value = j.waitForNextSensor1;
        document.getElementById("waitForNextSensor2").value = j.waitForNextSensor2;
        document.getElementById("waitAfterReading1").value = j.waitAfterReading1;
        document.getElementById("waitAfterReading2").value = j.waitAfterReading2;
      } catch (e) {
        alert("Error fetching data: " + e);
      }
    };

    document.getElementById("btnFetch").onclick = fetchData;

    document.getElementById("btnUpdate").onclick = async () => {
      const payload = {
        value: Number(document.getElementById("value").value),
        direction: Number(document.getElementById("direction").value),
        waitForNextSensor1: Number(document.getElementById("waitForNextSensor1").value),
        waitForNextSensor2: Number(document.getElementById("waitForNextSensor2").value),
        waitAfterReading1: Number(document.getElementById("waitAfterReading1").value),
        waitAfterReading2: Number(document.getElementById("waitAfterReading2").value)
      };
      try {
        const res = await fetch("/count", {
          method: "POST",
          headers,
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw await res.text();
        alert("Updated successfully!");
        fetchData();
      } catch (e) {
        alert("Error updating: " + e);
      }
    };

    document.getElementById("btnReset").onclick = async () => {
      try {
        const res = await fetch("/count", {
          method: "POST",
          headers,
          body: JSON.stringify({ value: 0 })
        });
        if (!res.ok) throw await res.text();
        alert("Count reset to 0");
        fetchData();
      } catch (e) {
        alert("Error resetting: " + e);
      }
    };


    // fetch on load
    fetchData();
  </script>

<h2>Światło – sterowanie bez JS</h2>

<form method="POST" action="/light/brightness_form">
  <label>Natężenie (1–254):
    <input type="number" name="brightness" min="1" max="254" required>
  </label>
  <button type="submit">Ustaw natężenie</button>
</form>

<form method="POST" action="/light/color_form">
  <label>Kolor:
    <select name="color">
      <option value="1">Niebieski</option>
      <option value="2">Czerwony</option>
      <option value="3">Zielony</option>
      <option value="4">Żółty</option>
    </select>
  </label>
  <button type="submit">Zmień kolor</button>
</form>

</body>
</html>
